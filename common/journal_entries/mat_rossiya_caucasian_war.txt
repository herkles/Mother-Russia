je_mat_rossyia_caucasian_war = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	group = je_group_global_international_situations

	should_be_involved = {
		mat_rossyia_caucasian_war_should_be_involved_trigger = yes
	}

	should_show_when_not_involved = {
		mat_rossyia_caucasian_war_interloper_trigger = yes
	}

	immediate = {
        set_global_variable = caucasian_war_happened
        c:CIR ?= {
            save_scope_as = circassia_scope
        }
        c:CHC ?= {
            save_scope_as = imamate_scope
        }
        c:RUS ?= {
            save_scope_as = russia_scope
        }
		s:STATE_KUBAN = {# Kuban
			region_state:RUS = {# Kuban - Russian
				add_modifier = caucasus_war_attacker	
			}
		}
		s:STATE_NORTH_CAUCASUS = {# Kuban
			region_state:RUS = {# Kuban - Russian
				add_modifier = caucasus_war_attacker	
			}
		}		
		s:STATE_DAGESTAN = {# Kuban
			region_state:RUS = {# Kuban - Russian
				add_modifier = caucasus_war_attacker	
			}
		}
	}

	immediate_all_involved = {
		if = {
			limit = {
				c:RUS ?= this
			}
			trigger_event = {
				id = mat_rossyia_caucasian_war.001 # Conquering the Caucasus
				days = 5
			}
		}
		if = {
			limit = {
				c:CIR ?= this
			}
			trigger_event = {
				id = mat_rossyia_caucasian_war.002 # The Russian Invansion
				days = 5
			}
		}
		if = {
			limit = {
				c:CHC ?= this
			}
			trigger_event = {
				id = mat_rossyia_caucasian_war.003 # The Peoples of the Empire
				days = 5
			}
		}                    
		else = {
			trigger_event = {
				id = mat_rossyia_caucasian_war.004 # The Eastern Question
				days = 5
			}
		}
	}


	on_monthly_pulse = {
		effect = {

		}
	}

    scripted_button = russia_escalate_caucasian_war
	
    status_desc = {
        first_valid = {
            triggered_desc = {
                desc = caucasian_war_milyutin_loc
                trigger = {
                    has_global_variable = milyutin_memorandum_accepted
                }
            }
            triggered_desc = {
                desc = caucasian_war_escalated_loc
                trigger = {
                    OR = {
                        has_global_variable = escalated_caucasian_war
                        NAND = {
                           c:CHC ?= {
                                has_truce_with = c:RUS
                            }
                            c:CIR ?= {
                                has_truce_with = c:RUS
                            }
                        }
                    }
                }
            }
            triggered_desc = {
                desc = caucasian_war_non_escalated_loc
                trigger = {
                    c:CHC ?= {
                        has_truce_with = c:RUS
                    }
                    c:CIR ?= {
                        has_truce_with = c:RUS
                    }
                }
            }
        }
    }

	custom_completion_header = je_mat_rossyia_caucasian_war_russian_victory

	complete = {
		scope:journal_entry = { is_goal_complete = yes }
		c:RUS ?= {
			is_at_war = no
		}
        custom_tooltip = {
            text = caucasus_secured_tt
            NOT = {
                exists = c:CIR
                exists = c:CHC
            }
        }
		s:STATE_KUBAN = {
			trigger_if = {

				limit = {
					NOT = { c:RUS = { has_state_in_state_region = STATE_KUBAN } }
				}
				c:RUS = { has_state_in_state_region = STATE_KUBAN }
			}
			region_state:RUS ?= {
				turmoil <= 0.25
				is_split_state = no
			}
		}
		s:STATE_DAGESTAN = {
			trigger_if = {
				limit = {
					NOT = { c:RUS = { has_state_in_state_region = STATE_DAGESTAN } }
				}
				c:RUS = { has_state_in_state_region = STATE_DAGESTAN }
			}
			region_state:RUS ?= {
				turmoil <= 0.25
				is_split_state = no
			}
		}
		s:STATE_NORTH_CAUCASUS = {
			trigger_if = {
				limit = {
					NOT = { c:RUS = { has_state_in_state_region = STATE_NORTH_CAUCASUS } }
				}
				c:RUS = { has_state_in_state_region = STATE_NORTH_CAUCASUS }
			}
			region_state:RUS ?= {
				turmoil <= 0.25
				is_split_state = no
			}
		}
	}

	custom_on_completion_header = je_mat_rossyia_caucasian_war_on_russian_victory
    on_complete = {
        set_global_variable = caucasus_consolidated_var
        if = {
            limit = {
                NOT = {
                    has_global_variable = imamate_defeated
                }
            }
            trigger_event = { id = caucasuswar_end.3 }
        }
        if = {
            limit = {
                NOT = {
                    has_global_variable = circassia_defeated
                }
            }
            trigger_event = { id = caucasuswar_end.1 }
        }
    }

	on_complete_all_involved = {
		# mat_rossyia_caucasian_war_cleanup_effect = yes
		trigger_event = {
			id = mat_rossyia_caucasian_war.010 # Dominion Over the Caucausus
		}
	}

	custom_failure_header = je_mat_rossyia_caucasian_war_rebel_victory

	fail = {# Failure means Russia has lost control
        custom_tooltip = {
            text = caucasus_lost_tt
            NOT = {
				c:RUS = {
					any_scope_state = {
						state_region = s:STATE_DAGESTAN
					}
					any_scope_state = {
						state_region = s:STATE_KUBAN
					}
					any_scope_state = {
						state_region = s:STATE_NORTH_CAUCASUS
					}
				}
            }
        }
	}

	custom_on_failure_header = je_mat_rossyia_caucasian_war_on_rebel_victory

	on_fail_all_involved = {
		# mat_rossyia_caucasian_war_cleanup_effect = yes
		trigger_event = {
			id = mat_rossyia_caucasian_war.011 # The Caucausus are Lost
		}
	}

	invalid = {
		NOT = {
			exists = c:RUS
		}
	}

	progressbar = yes

	weight = 10000

	should_be_pinned_by_default = yes
}

